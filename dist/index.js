"use strict";exports.__esModule=!0,exports.createAnyState=void 0;var getIn=function(t,e){var n=t;return e.forEach(function(t){void 0!==n&&(n=n[t])}),n},clonedValues=function(t){return t},setIn=function(t,n,e){var r=t,o="object"==typeof e?e:e;return n.forEach(function(t,e){void 0!==r&&(e===n.length-1?r[t]=o:r=r[t])}),t},toObject=function(t){return"object"==typeof t?clonedValues(t):t},getPaths=function(t){return t.split(/\[|\]|\./g).reduce(function(t,e){return""!==e&&null!=e&&(/^\d+$/.test(e)?t.push(parseInt(e,10)):t.push(e)),t},[])},getIdPath=function(t){return t.join("/")},AnyState=function(t){function r(i){return void 0===i&&(i=[]),{get:function(t,e){var n;return"object"==typeof t[e]&&null!==t[e]?(n=i.concat([e]),new Proxy(t[e],r(n))):t[e]},set:function(t,r,e){var n=i.concat([r]),o=clonedValues(s),a=getIdPath(n);return t[r]=e,c.forEach(function(t){var e,n;t&&0===t.key.indexOf(a)&&(typeof(e=getIn(o,t.paths))!=typeof(n=getIn(s,t.paths))&&console.warn("Type mismatch for ".concat(r)),t.callback(n,e))}),!0}}}var c=[],s=new Proxy(t,r());return{setState:function(t){s=new Proxy(t,r())},setItem:function(t,e){var n=[];if(!Array.isArray(t)&&"string"!=typeof t&&"number"!=typeof t)throw new Error("setItem: key must be a string or an array of strings");if(!s)throw new Error("State is not initialized");"string"==typeof t?n=getPaths(t):"number"==typeof t?n=[t]:Array.isArray(t)&&(n=t),void 0===getIn(s,n)&&console.warn("Trying to set item ".concat(t," but it doesn't exist")),s=setIn(s,n,e)},getState:function(){return toObject(s)},getItem:function(t){var e=t;if(Array.isArray(t)||"string"==typeof t||"number"==typeof t)return"string"==typeof t&&(e=getPaths(t)),t=getIn(s,e),toObject(t);throw new Error("setItem: key must be a string or an array of strings")},watch:function(t,e){if(!s)throw new Error("State is not initialized");if("function"!=typeof e)throw new Error("callback must be a function");var n=getPaths(t),t=(void 0===getIn(s,n)&&console.warn("Trying to watch item ".concat(t," but it doesn't exist")),getIdPath(n));c.push({key:t,callback:e,paths:n})}}},createAnyState=function(t){return AnyState(clonedValues(t))};exports.createAnyState=createAnyState;